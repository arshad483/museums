<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Niche Museums</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
    <style>
    body{max-width:600px;}
    .distance-away {
        font-size: 0.8em;
        font-weight: bold;
    }
    span.permanently-closed {
        display: inline-block;
        background-color: #fff;
        border: 2px solid red;
        padding: 3px 8px;
        border-radius: 6px;
        font-family: courier;
        font-weight: bold;
        transform: rotate(3deg);
        position: absolute;
        top: 12px;
        right: 12px;
    }
    </style>
  </head>
  <body>
    <section class="hero is-dark is-bold">
    <div class="hero-body">
        <div class="container">
          <h1 class="title">
              Niche Museums
          </h1>
          <h2 class="subtitle">
              Find tiny museums near you
          </h2>
          <div class="buttons" style="display: none" id="buttons">
              <button class="button is-link">Use my location</button>
          </div>
      </div>
    </div>
    </section>
    <section class="section" id="cards"></section>
<script type="module">
import {html, render} from 'https://unpkg.com/lit-html@0.7.1/lit-html.js';
const card = (data) => html`<div class="card box">
  ${data.photo_url && html`<div class="card-image">
    <figure class="image is-4by2">
      <img src="${data.photo_url}?w=800&h=400&fit=crop&auto=compress" alt="${data.photo_alt}">
    </figure>
  </div>`}
  <div class="card-content">
    <div class="content">
      ${data.permanently_closed && html`<span class="permanently-closed">Permanently closed</span>`}
      <h2>${data.name}</h2>
      ${data.distance_mi && html`<p class="distance-away">${data.distance_mi.toFixed(1)} miles away</p>`}
      <p>${data.description || null}</p>
      <p><a href="${data.url}">Website</a>${data.wikipedia_url && html` | <a href="${data.wikipedia_url}">Wikipedia</a>`}</p>
      <address>${data.address} - <a href="https://www.google.com/maps/?q=${data.latitude},${data.longitude}">Map</a></address>
    </div>
  </div>
</div>`;
const cards = (museums) => html`${museums.map(card)}`;
async function loadMuseums(latitude, longitude) {
    let section = document.getElementById("cards");
    // Default: most recently added museums
    let url = "/museums/museums.json?_shape=array&_sort_desc=id";
    if (latitude && longitude) {
        // Closest museums
        url = `/museums/nearby.json?_shape=array&latitude=${latitude}&longitude=${longitude}`;
    }
    var museums = await (await fetch(url)).json();
    render(cards(museums), section);
}
if (navigator.geolocation) {
    let buttons = document.getElementById("buttons");
    buttons.style.display = "block";
    buttons.getElementsByTagName("button")[0].onclick = () => {
        window.navigator.geolocation.getCurrentPosition((position) => {
            loadMuseums(position.coords.latitude.toFixed(3), position.coords.longitude.toFixed(3));
        });
    }
}
loadMuseums();
</script>

  </body>
</html>
