<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Niche Museums</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
    <style>
    body { max-width: 600px; }
    .distance-away {
        font-size: 0.8em;
        font-weight: bold;
    }
    </style>
  </head>
  <body>
    <section class="hero is-dark is-bold">
    <div class="hero-body">
        <div class="container">
        <h1 class="title">
            Niche Museums
        </h1>
        <h2 class="subtitle">
            Find tiny museums near you
        </h2>
        <div class="buttons" style="display: none" id="buttons">
            <button class="button is-link">Use my location</button>
        </div>
        </div>
    </div>
    </section>
    <section class="section" id="cards"></section>
<script type="module">
import {html, render} from 'https://unpkg.com/lit-html?module';
const card = (data) => html`<div class="card box">
  <!-- <div class="card-image">
    <figure class="image is-4by2">
      <img src="https://bulma.io/images/placeholders/1280x960.png" alt="Placeholder image">
    </figure>
  </div> -->
  <div class="card-content">
    <div class="content"> <h2>${data.name}</h2>
      ${data.distance_mi && html`<p class="distance-away">${data.distance_mi.toFixed(1)} miles away</p>`}
      <p>${data.description || null}</p>
      <p><a href="${data.url}">Website</a></p>
      <address>${data.address} - <a href="https://www.google.com/maps/?q=${data.latitude},${data.longitude}">map</a></address>
    </div>
  </div>
</div>`;
const cards = (museums) => html`${museums.map(card)}`;
async function loadMuseums(latitude, longitude) {
    let section = document.getElementById("cards");
    let url = "/museums/museums.json?_shape=array";
    if (latitude && longitude) {
        url = `/museums/nearby.json?_shape=array&latitude=${latitude}&longitude=${longitude}`;
    }
    var museums = await (await fetch(url)).json();
    render(cards(museums), section);
}
if (navigator.geolocation) {
    let buttons = document.getElementById("buttons");
    buttons.style.display = "block";
    buttons.getElementsByTagName("button")[0].onclick = () => {
        window.navigator.geolocation.getCurrentPosition((position) => {
            loadMuseums(position.coords.latitude.toFixed(3), position.coords.longitude.toFixed(3));
        });
    }
}
loadMuseums();
</script>

  </body>
</html>
